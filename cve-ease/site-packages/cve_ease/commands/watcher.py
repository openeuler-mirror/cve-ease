# -*- coding: utf-8 -*-

"""
 (c) 2023 - Copyright CTyunOS Inc

 Authors:
   youyifeng <youyf2@chinatelecom.cn>

"""

from optparse import OptionParser
from cve_ease.notifier import Dingding
import logging

logger = logging.getLogger('cve-ease')


def get_usage_str(usage):
    return usage + "\n(Specify the --help global option for a list of other help options)"


def handle_watcher(gconfig, db_session, args):
    """[basic]  watcher"""
    usage = "usage: %prog watcher <options>"
    parser = OptionParser(usage=get_usage_str(usage))

    parser.add_option('-s', '--show', dest='show', action='store_true', default=False,
                      help='show watcher config')
    parser.add_option('-v', '--verbose', dest='verbose', action='store_true', default=False,
                      help='show verbose output')

    (options, args) = parser.parse_args(args)

    if options.show:
        for item in gconfig.config:
            section = gconfig.config[item]
            if 'watch_pkg' in section and 'enabled' in section and section['enabled'] == '1':
                print("find watcher: ", item)
                for kv in section:
                    print(f' {kv} = {section[kv]}')
                print()
    else:
        parser.print_help()
